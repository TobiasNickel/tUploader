tUploader=function(f){function k(a){a.stopPropagation();a.preventDefault()}function p(a){a.stopPropagation();a.preventDefault();console.log("dragOver");d.autoDroparea&&(g.style.display="block")}function l(a){a.stopPropagation();a.preventDefault();g.style.display="none"}function m(a){g.style.display="none";a.files=[];for(var b=a.dataTransfer.files.length;b--;)a.files.push(a.dataTransfer.files[b]);if(d.acceptedFileExtensions)for(b=a.files.length;b--;){var c=a.files[b].name.slice(a.files[b].name.lastIndexOf("."));
-1==d.acceptedFileExtensions.indexOf(c)&&a.files.splice(b,1)}d.preprocess(a,function(b){b||(b={});if(a.files.length){a.stopPropagation();a.preventDefault();a.bitrate=new tStabilizer(5);d.uploads.push(a);b.path=b.path||d.stdUploadPath;for(var c=a.files,f=new FormData,h=0;h<c.length;h++){var g=c[h];f.append("files[]",g,g.name)}c="";if(b.get)for(h in b.get)c+=(c.length?"":"?")+h+b.get[h];if(b.post)for(h in post)f.append(h,post[h]);var e=new XMLHttpRequest;e.open("POST",b.path+(c.length?c:""),!0);e.onload=
function(){200===e.status?(d.uploads.splice(d.uploads.indexOf(a),1),d.trigger("progress",{event:a,progress:1,bitrate:0}),d.trigger("success",{event:a})):d.trigger("error",{event:a})};var k=0,l=0;e.upload.addEventListener("progress",function(b){var c=b.loaded/b.total,e=parseInt((b.loaded-k)/(b.timeStamp-l));a.bitrate.push(e);a.total=b.total;a.loaded=b.loaded;a.progress=c;d.trigger("progress",{event:a,progressEvent:b,progress:c,bitrate:a.bitrate.getAvarage(),globalProgress:d.getGlobalProgress()});k=
b.loaded;l=b.timeStamp});e.send(f);d.trigger("begin",{event:a})}})}tStabilizer=function(a){a=a||Infinity;this.values=[];this.push=function(b){for(this.values.push(b);this.values.length>a;)this.values.shift()};this.getAvarage=function(){return this.getSum()/this.values.length};this.getMax=function(){for(var b=-Infinity,a=this.values.length;a--;)b=b<this.values[a]?this.values[a]:b;return b};this.getMin=function(){for(var b=Infinity,a=this.values.length;a--;)b=b>this.values[a]?this.values[a]:b;return b};
this.getSum=function(){for(var b=0,a=this.values.length;a--;)b+=this.values[a];return b}};var n=null,e=f.createElement("input");e.setAttribute("type","file");e.setAttribute("multiple","true");e.onchange=function(){m({dataTransfer:{files:e.files},stopPropagation:function(){},preventDefault:function(){}})};var g=f.createElement("div");g.setAttribute("style","position:fixed;top:0px;bottom:0px;right:0px;left:0px;z-index:100;background-color:rgba(255,255,50,0.6);border:brown dashed 3px;display:none;margin:0px;");
window.addEventListener("load",function(){n=f.body;n.appendChild(g);f.addEventListener("dragenter",k,!1);f.addEventListener("dragstart",k,!1);g.addEventListener("dragleave",l,!1);f.addEventListener("dragend",l,!1);f.addEventListener("dragover",p,!1);f.addEventListener("drop",m,!1)});var d={openFilebrowser:function(){e.click()},preprocess:function(a,b){b({})},stdUploadPath:"upload.json",getGlobalProgress:function(){for(var a=0,b=0,c=0;c<this.uploads.length;c++)a+=this.uploads[c].progress*this.uploads[c].total,
b+=this.uploads[c].total;return 0==a&&0==b?1:a/b},setAccept:function(a){e.setAttribute("accept",a);if(a)switch(a){case "imgage/*":this.acceptedFileExtensions=".jpg,.jpeg,.png,.gif,.tif,.bmp";break;case "audio/*":this.acceptedFileExtensions=".mp3,.mp4,.odd,.wav";break;default:this.acceptedFileExtensions=a}else this.acceptedFileExtensions=null},acceptedFileExtensions:null,input:e,uploads:[],autoDropareaElement:g,autoDroparea:!0};(function(a){a._events={};a.on=function(b,a){b=b.toLowerCase();b in this._events||
(this._events[b]=[]);-1===this._events[b].indexOf(a)&&this._events[b].push(a)};a.off=function(a,c){a?c?delete this._events[a][this._events[a].indexOf(c)]:delete this._events[a]:this._events={}};a.trigger=function(a,c){if(a&&this._events[a])for(var d=this._events[a].length;d--;)this._events[a][d](c)}})(d);return d}(document);
