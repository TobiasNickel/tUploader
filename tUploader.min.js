(function(e){function k(a){a.stopPropagation();a.preventDefault()}function p(a){a.stopPropagation();a.preventDefault();console.log("dragOver");tUploader.autoDroparea&&(d.style.display="block")}function l(a){a.stopPropagation();a.preventDefault();d.style.display="none"}function m(a){d.style.display="none";a.files=[];for(var b=a.dataTransfer.files.length;b--;)a.files.push(a.dataTransfer.files[b]);if(tUploader.acceptedFileExtensions)for(b=a.files.length;b--;){var c=a.files[b].name.slice(a.files[b].name.lastIndexOf("."));
-1==tUploader.acceptedFileExtensions.indexOf(c)&&a.files.splice(b,1)}tUploader.preprocess(a,function(b){b||(b={});if(a.files.length){b.path=b.path||tUploader.stdUploadPath;a.stopPropagation();a.preventDefault();a.bitrate=new tStabilizer(5);tUploader.uploads.push(a);for(var c=a.dataTransfer.files,e=new FormData,g=0;g<c.length;g++){var h=c[g];e.append("files[]",h,h.name)}h="";if(b.get)for(g in b.get)h+=(h.length?"":"?")+g+b.get[g];if(b.post)for(g in post)e.append(g,post[g]);var d=new XMLHttpRequest;
d.open("POST",b.path+(h.length?h:""),!0);d.onload=function(){200===d.status?(tUploader.uploads.splice(tUploader.uploads.indexOf(a),1),tUploader.trigger("progress",{event:a,progress:1,bitrate:0}),tUploader.trigger("success",{event:a})):tUploader.trigger("error",{event:a})};tUploader.trigger("start",{event:a});var f=0,k=0;d.upload.addEventListener("progress",function(b){var c=b.loaded/b.total,d=parseInt((b.loaded-f)/(b.timeStamp-k));a.bitrate.push(d);a.total=b.total;a.loaded=b.loaded;a.progress=c;tUploader.trigger("progress",
{event:b,progress:c,bitrate:a.bitrate.getAvarage(),globalProgress:tUploader.getGlobalProgress()});f=b.loaded;k=b.timeStamp});d.send(e);tUploader.trigger("begin",{files:c})}})}tStabilizer=function(a){a=a||Infinity;this.values=[];this.push=function(b){for(this.values.push(b);this.values.length>a;)this.values.shift()};this.getAvarage=function(){return this.getSum()/this.values.length};this.getMax=function(){for(var b=-Infinity,a=this.values.length;a--;)b=b<this.values[a]?this.values[a]:b;return b};this.getMin=
function(){for(var b=Infinity,a=this.values.length;a--;)b=b>this.values[a]?this.values[a]:b;return b};this.getSum=function(){for(var b=0,a=this.values.length;a--;)b+=this.values[a];return b}};var n=null,f=e.createElement("input");f.setAttribute("type","file");f.setAttribute("multiple","true");f.onchange=function(){m({dataTransfer:{files:f.files},stopPropagation:function(){},preventDefault:function(){}})};var d=e.createElement("div");d.setAttribute("style","position:fixed;top:0px;bottom:0px;right:0px; left:0px; z-index:100; background-color:rgba(255,255,50,0.6);border:brown dashed 3px;display:none; margin:0px; ");
window.addEventListener("load",function(){n=e.body;n.appendChild(d);e.addEventListener("dragenter",k,!1);e.addEventListener("dragstart",k,!1);d.addEventListener("dragleave",l,!1);e.addEventListener("dragend",l,!1);e.addEventListener("dragover",p,!1);e.addEventListener("drop",m,!1)});window.tUploader={openFilebrowser:function(){f.click()},preprocess:function(a,b){b({})},stdUploadPath:"upload.json",getGlobalProgress:function(){for(var a=0,b=0,c=0;c<this.uploads.length;c++)a+=this.uploads[c].progress*
this.uploads[c].total,b+=this.uploads[c].total;return 0==a&&0==b?1:a/b},setAccept:function(a){f.setAttribute("accept",a);if(a)switch(a){case "imgage/*":this.acceptedFileExtensions=".jpg,.jpeg,.png,.gif,.tif,.bmp";break;case "audio/*":this.acceptedFileExtensions=".mp3,.mp4,.odd,.wav";break;default:this.acceptedFileExtensions=a}else this.acceptedFileExtensions=null},acceptedFileExtensions:null,input:f,uploads:[],autoDropareaElement:d,autoDroparea:!0};(function(a){a._events={};a.on=function(b,a){b=b.toLowerCase();
b in this._events||(this._events[b]=[]);-1===this._events[b].indexOf(a)&&this._events[b].push(a)};a.off=function(a,c){a?c?delete this._events[a][this._events[a].indexOf(c)]:delete this._events[a]:this._events={}};a.trigger=function(a,c){if(a&&this._events[a])for(var d=this._events[a].length;d--;)this._events[a][d](c)}})(window.tUploader)})(document);